INSERT INTO genres (
    id,
    code,
    title_ru,
    title_en,
    description,
    category,
    created_at
  )
VALUES (
    'id:uuid',
    'code:text',
    'title_ru:text',
    'title_en:text',
    'description:text',
    'category:text',
    'created_at:timestamp without time zone'
  );# План курсового проекта: База знаний «Творчество Хаяо Миядзаки»

## 1. Цель и область проекта
- **Цель**: разработать динамический веб-сайт с интуитивным интерфейсом, представляющий базы знаний о творчестве Хаяо Миядзаки.
- **Область**:
  - Реляционная БД (минимум 4 нормализованные таблицы) с данными о фильмах, персонажах, творческих командах, студии Ghibli, наградах и тематике.
  - Backend API для CRUD-операций и наглядной выборки данных.
  - Frontend, который динамически отображает карточки фильмов, персонажей и связанных сущностей.
  - Дополнительные сценарии: поиск, фильтры по тематике/годам, временная шкала работ.

## 2. Текущее состояние (шаблон)
- **Frontend**: отсутствует, требуется разработать структуру страниц и дизайн.
- **Backend**: не создан; требуется выбрать фреймворк и организовать архитектуру.
- **База данных**: не инициализирована; ER-диаграмма и SQL-скрипты ещё не подготовлены.

## 3. Запланированный стек и архитектура
- **Backend**: Node.js + Express — минимальный REST API на чистом JavaScript, модульное разделение по ресурсам.
- **База данных**: PostgreSQL с поддержкой внешних ключей, ограничений и (опционально) расширения `pgvector` для поиска по похожести.
- **Доступ к БД**: нативный пакет `pg`, SQL-запросы и подготовленные выражения; миграции и сиды в отдельных SQL-файлах.
- **Frontend**: статические HTML-страницы, стилизованные кастомным CSS (BEM/utility-классы) и интерактивность на чистом ES6 JavaScript без фреймворков.
- **Организация CSS**: модульные файлы по страницам и общим компонентам, использование CSS-переменных для цветовой схемы.
- **Статика и модули JS**: подключение через `<script type="module">`, файлы со службами API, утилитами рендеринга и управлением состоянием.
- **Проектная структура (пример)**:
  - `/server` — backend (модули: `works`, `persons`, `characters`, `themes`, `awards`, `search`).
  - `/public` — HTML-файлы, стили (`/public/styles`), скрипты (`/public/scripts`), ассеты.
  - `/db` — схема, миграции, сиды, ER-диаграммы.

## 4. Проектирование базы знаний (PostgreSQL)

### 4.1 Таблицы

#### 4.1.1 works (произведения)
- `id` (PK, UUID)
- `title_ru`, `title_en`, `release_year`, `type` (фильм, короткометражка, манга)
- `synopsis`, `setting` (описание мира/локации)
- `poster_url`, `trailer_url`, `runtime_minutes`
- `created_at`, `updated_at`

#### 4.1.2 persons (персоны)
- `id` (PK)
- `full_name_ru`, `full_name_en`
- `roles` (JSONB: режиссёр, сценарист, композитор и т. д.)
- `biography`, `birth_date`, `country`
- `photo_url`, `website`

#### 4.1.3 characters (персонажи)
- `id` (PK)
- `name_ru`, `name_en`, `description`
- `symbolism` (ключевые мотивы, значение)
- `image_url`
- `first_appearance_year`

#### 4.1.4 themes (темы/мотивы)
- `id` (PK)
- `code`, `title_ru`, `title_en`
- `description`
- `category` (например, «экология», «взросление», «магия»)

#### 4.1.5 awards (награды и фестивали)
- `id` (PK)
- `name`, `category`, `presented_by`
- `year_started`, `location`
- `description`, `prestige_level`

Дополнительные таблицы для нормализации:
- `work_persons` — связь M:N между произведениями и персонами (поля: `work_id`, `person_id`, `role`, `is_primary`).
- `work_characters` — связь M:N между произведениями и персонажами (`work_id`, `character_id`, `importance`).
- `work_themes` — связь M:N для тем (`work_id`, `theme_id`).
- `work_awards` — фиксация наград (`work_id`, `award_id`, `award_year`, `result`).

### 4.2 Связи
- `works ↔ persons`: M:N через `work_persons`, с указанием роли (режиссёр, композитор).
- `works ↔ characters`: M:N через `work_characters`.
- `works ↔ themes`: M:N для тематической фильтрации и тегов.
- `works ↔ awards`: M:N через `work_awards` (год, категория, результат).
- `persons ↔ awards` (опционально): через таблицу `person_awards` для персональных наград.

### 4.3 Seed-данные (~30 записей)
- 15+ записей в `works` (фильмы, короткометражки, манга) с ключевыми полями.
- 15+ записей в `persons` (режиссёры, сценаристы, композиторы, художники).
- 20+ записей в `characters` с описаниями и образом.
- 10–12 тем в `themes`, покрывающих основные мотивы творчества.
- 8–10 наград в `awards` с уровнями престижа.
- Соответствующие связи в `work_persons`, `work_characters`, `work_themes`, `work_awards` для демонстрации целостности.

## 5. Дизайн CRUD API

### 5.1 Works
- `GET /api/works` — фильтры по типу, периоду, темам, наличию наград.
- `GET /api/works/:id` — полная карточка с персонами, персонажами, темами, наградами.
- `POST /api/works` — создание произведения + привязка связей через тела запроса.
- `PUT /api/works/:id` — изменение полей и связанных сущностей.
- `DELETE /api/works/:id` — каскадное удаление связей (`work_*`).

### 5.2 Persons
- `GET /api/persons` — список персон с фильтрами по ролям и периоду активности.
- `GET /api/persons/:id` — карточка персоны с участием в произведениях и наградами.
- `POST /api/persons`, `PUT /api/persons/:id`, `DELETE /api/persons/:id` — управление данными и связями `work_persons`.

### 5.3 Characters
- `GET /api/characters` — фильтры по связям с произведениями, архетипам, темам.
- `GET /api/characters/:id` — подробности и список появлений.
- `POST/PUT/DELETE` — поддержание записей и `work_characters`.

### 5.4 Themes
- `GET /api/themes` — выдача всех тем, группировка по категориям.
- `GET /api/themes/:id` — описание темы и связанные произведения.
- `POST/PUT/DELETE` — управление каталогом тем и таблицей `work_themes`.

### 5.5 Awards
- `GET /api/awards` — фильтры по престижности, году.
- `GET /api/awards/:id` — информация о награде и список работ-победителей.
- `POST/PUT/DELETE` — управление справочником наград, обновление `work_awards`.

### 5.6 Search & Timeline (опционально)
- `GET /api/search` — объединённый поиск по работам, персонам, персонажам (полнотекст + фильтры).
- `GET /api/timeline` — данные для временной шкалы релизов и наград.

## 6. Поиск и рекомендации
- **Полнотекстовый поиск** по названиям, темам, персонажам (PostgreSQL `tsvector`).
- **Тематика/настроение**: фильтры по тегам (например, «экологические сказки», «истории взросления»).
- **Рекомендации**: формула похожести по темам, студии и создателям (в перспективе — использование `pgvector`).
- **API**: `GET /api/search?query=...&theme=...` возвращает список работ с оценкой релевантности.

## 7. Интерфейс и пользовательский опыт
- Главная страница с героем, лентой релизов и блоком «Рекомендуем посмотреть» (рендер через шаблонные строки JS).
- Каталог работ с фильтрами по темам, наградам, периодам и участию персон.
- Каталог персонажей: грид с портретами, фильтрами по произведениям и мотивам.
- Раздел персон: список ключевых участников с ролями, переход на подробные профили.
- Раздел тем: визуальный каталог мотивов с примерами произведений.
- Раздел наград: таблица наград и связанные произведения.
- Адаптивный дизайн на чистом CSS (flex, grid, медиа-запросы), тёмная/светлая темы через CSS-переменные.
- Повышение доступности: семантические теги, aria-атрибуты, управление с клавиатуры.

## 8. Этапы реализации (вехи)
1. **Инициализация репозитория** — настройка Node-пакетов, ESLint/Prettier, базовая структура `/server`, `/public`, `/db`.
2. **База данных** — ER-диаграмма под `works`, `persons`, `characters`, `themes`, `awards`, подготовка миграций и сидов.
3. **Базовый backend** — настройка Express, модули `works` и `persons`, обработка ошибок, тестовые эндпоинты.
4. **Расширение API** — добавление `characters`, `themes`, `awards`, сервис поиска и временной шкалы.
5. **Frontend MVP** — верстка главной и каталога работ, загрузка данных через Fetch API, динамический рендер карточек.
6. **Разделы персонажей и персон** — интерфейсы списков, профилей, модалок.
7. **Темы и награды** — UI-каталоги, фильтры, визуализация наград.
8. **Поиск и фильтры** — интеграция полнотекстового поиска, клиентские контролы и состояние фильтров.
9. **Полировка и тестирование** — unit-тесты backend (Jest), ручное UI-тестирование, оптимизация CSS/JS, кроссбраузерная проверка.
10. **Документация и презентация** — README, инструкция по запуску, сценарий демонстрации и итоговые материалы.

## 9. Раздел «Персоны»
1. **API персон** — `GET /api/persons`, `GET /api/persons/:id`, статистика по видам участия.
2. **Каталог персон** — карточки с ролями, ключевыми работами, фильтр по специализации (режиссёр, композитор и т. д.).
3. **Профиль персоны** — биография, цитаты, временная шкала участия в работах, раздел наград.
4. **Связи с работами** — визуализация вкладов (например, диаграмма или таблица ролей).

## 10. Каталог персонажей и тематические подборки
1. **API персонажей** — фильтры по архетипам, связанным работам, мотивам.
2. **Каталог персонажей** — карточки с портретами, поиском, фильтрами по темам и годам появления.
3. **Профиль персонажа** — история, цитаты, визуализация связей с темами и работами.
4. **Тематические подборки** — страницы/блоки, использующие `themes` и `work_themes` для группировки произведений.

## 11. Главная страница и блоки наград
1. **Последние обновления** — `GET /api/works?limit=n&sort=updated_at` для свежих карточек.
2. **Рекомендуемые темы** — вывод популярных тем и связанных произведений.
3. **Лучшие награждённые** — блок с выдачей из `work_awards`, сортировка по престижу наград.
4. **Медиацентр** — галерея концепт-артов, трейлеров и интервью (статические/динамические ссылки).
5. **Функционал избранного** (опционально) — сохранение карточек в локальном хранилище.

## 12. Документация и итоговая защита
- README с инструкциями по запуску, сборке seed-данных и доступных эндпоинтах.
- Технический отчёт: постановка задачи, архитектура, модель данных, реализация, тесты.
- Презентация с ER-диаграммой, схемами интерфейсов, демонстрационным сценарием.
