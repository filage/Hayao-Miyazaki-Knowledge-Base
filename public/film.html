<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–§–∏–ª—å–º ‚Äî –•–∞—è–æ –ú–∏—è–¥–∑–∞–∫–∏</title>
    <link rel="stylesheet" href="./styles/base.css" />
    <link rel="stylesheet" href="./styles/film.css" />
    <script>
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark-mode');
      }
    </script>
  </head>
  <body>
    <nav class="top-nav light-mode">
      <div class="top-nav__inner">
        <a class="top-nav__brand" href="./index.html">–•–∞—è–æ –ú–∏—è–¥–∑–∞–∫–∏</a>
        <ul class="top-nav__menu">
          <li><a class="top-nav__link" href="./index.html">–§–∏–ª—å–º—ã</a></li>
          <li><a class="top-nav__link" href="./timeline.html">–¢–∞–π–º–ª–∞–π–Ω</a></li>
          <li>
            <button class="theme-toggle" id="theme-toggle" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
              <span class="toggle-icon sun-icon">‚òÄÔ∏è</span>
              <span class="toggle-icon moon-icon">üåô</span>
            </button>
          </li>
          <li id="nav-auth"></li>
        </ul>
      </div>
    </nav>
    <script>
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      (function() {
        const navAuth = document.getElementById('nav-auth');
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        
        if (token && user.username) {
          navAuth.innerHTML = '<span class="nav-user">' +
            '<a href="./profile.html" class="nav-user-link">üë§ ' + (user.displayName || user.username) + '</a>' +
            (user.role === 'admin' ? ' <a href="./admin.html" class="nav-admin-btn">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>' : '') +
            ' <a href="#" class="nav-logout-btn" onclick="logout()">–í—ã–π—Ç–∏</a>' +
            '</span>';
        } else {
          navAuth.innerHTML = '<a href="./login.html" class="top-nav__link">–í–æ–π—Ç–∏</a>';
        }
        
        window.logout = async function() {
          await fetch('/api/auth/logout', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } });
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          location.reload();
        };
      })();
    </script>

    <main class="film-page">
      <div class="film-hero" id="film-hero">
      <div class="film-container">
        <!-- –ü–æ—Å—Ç–µ—Ä —Å–ª–µ–≤–∞ -->
        <div class="film-poster">
          <img id="film-poster-img" src="" alt="–ü–æ—Å—Ç–µ—Ä —Ñ–∏–ª—å–º–∞" />
          <div class="film-trailer" id="film-trailer-section" hidden>
            <button id="show-trailer-btn" class="btn-trailer">–¢—Ä–µ–π–ª–µ—Ä</button>
          </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å–º–µ —Å–ø—Ä–∞–≤–∞ -->
        <div class="film-info">
          <h1 id="film-title" class="film-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
          <p id="film-original-title" class="film-original-title"></p>
          
          <div class="film-meta">
            <span id="film-rating" class="film-rating" hidden>
              <span class="rating-value">0.0</span>
            </span>
            <span id="film-age-rating" class="film-age-pill" hidden></span>
          </div>

          <div id="film-genres" class="film-genres"></div>

          <p id="film-synopsis" class="film-synopsis">–ó–∞–≥—Ä—É–∑–∫–∞...</p>

          <div class="film-actions" id="film-actions" hidden>
            <button class="btn btn-watchlist" id="btn-watchlist" data-status="">
              <span>üìã –í –ø–ª–∞–Ω–∞—Ö</span>
            </button>
            <button class="btn btn-watched" id="btn-watched" data-status="">
              <span>‚úì –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</span>
            </button>
            <button class="btn btn-favorite" id="btn-favorite" data-status="">
              <span>‚ù§ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </button>
          </div>
          <p id="auth-hint" class="auth-hint"><a href="./login.html">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å–º—ã –≤ —Å–ø–∏—Å–∫–∏</p>

          <!-- –î–µ—Ç–∞–ª–∏ –æ —Ñ–∏–ª—å–º–µ -->
          <section class="film-details">
            <h2>–û —Ñ–∏–ª—å–º–µ</h2>
            <dl class="details-list">
              <div class="details-row">
                <dt>–ì–æ–¥ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</dt>
                <dd id="film-year">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–°—Ç—Ä–∞–Ω–∞</dt>
                <dd id="film-country">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–†–µ–∂–∏—Å—Å–µ—Ä</dt>
                <dd id="film-director">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–°—Ü–µ–Ω–∞—Ä–∏–π</dt>
                <dd id="film-screenwriter">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–ü—Ä–æ–¥—é—Å–µ—Ä</dt>
                <dd id="film-producer">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä</dt>
                <dd id="film-composer">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–•—É–¥–æ–∂–Ω–∏–∫</dt>
                <dd id="film-artist">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–û–ø–µ—Ä–∞—Ç–æ—Ä</dt>
                <dd id="film-cinematographer">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–ú–æ–Ω—Ç–∞–∂</dt>
                <dd id="film-editor">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–ë—é–¥–∂–µ—Ç</dt>
                <dd id="film-budget">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–°–±–æ—Ä—ã –≤ –º–∏—Ä–µ</dt>
                <dd id="film-box-office">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–ü—Ä–µ–º—å–µ—Ä–∞ –≤ –º–∏—Ä–µ</dt>
                <dd id="film-premiere">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–í–æ–∑—Ä–∞—Å—Ç</dt>
                <dd id="film-age">‚Äî</dd>
              </div>
              <div class="details-row">
                <dt>–í—Ä–µ–º—è</dt>
                <dd id="film-runtime">‚Äî</dd>
              </div>
            </dl>
          </section>

          <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ -->
          <section class="film-section">
            <h2>–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h2>
            <div id="film-characters" class="characters-grid"></div>
          </section>

          <!-- –ù–∞–≥—Ä–∞–¥—ã -->
          <section class="film-section" id="film-awards-section" hidden>
            <h2>–ù–∞–≥—Ä–∞–¥—ã</h2>
            <div id="film-awards" class="awards-list"></div>
          </section>

          <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
          <section class="film-section comments-section">
            <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ <span id="comments-count"></span></h2>
            
            <div id="comment-form-container" class="comment-form-container" hidden>
              <textarea id="comment-input" class="comment-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." maxlength="2000"></textarea>
              <div class="comment-form-actions">
                <span id="comment-chars">0 / 2000</span>
                <button id="submit-comment" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
              </div>
            </div>
            
            <div id="login-prompt" class="login-prompt" hidden>
              <p>–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="./login.html">–≤–æ–π–¥–∏—Ç–µ</a> –∏–ª–∏ <a href="./register.html">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a></p>
            </div>
            
            <div id="comments-list" class="comments-list"></div>
            <div id="comments-empty" class="comments-empty" hidden>
              <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            </div>
          </section>
        </div>
      </div>
      </div>

      <!-- –¢—Ä–µ–π–ª–µ—Ä –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
      <div id="trailer-modal" class="modal">
        <div class="modal-content">
          <button class="modal-close" id="close-trailer">&times;</button>
          <iframe id="trailer-iframe" src="" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>
    </main>

    <footer class="footer">
      <p>¬© 2025 filage</p>
      <a href="https://github.com/filage" target="_blank" class="footer-github">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        GitHub
      </a>
    </footer>

    <script type="module" src="./scripts/film.js"></script>
  </body>
</html>
